"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var t=require("react"),n=e(t),r=e(require("js-cookie")),o=require("@tinacms/react-core"),i=require("tinacms"),a=require("@tinacms/styles"),u=require("@tinacms/react-forms"),c=require("styled-components"),l=e(c),s=require("@tinacms/icons"),h=require("@tinacms/fields"),m=require("react-dismissible"),f=require("@tinacms/react-modals"),p=require("final-form"),d=require("next-tinacms-markdown");function g(){return(g=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function v(e){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e,t){return(b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function y(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function E(e,t,n){return(E=y()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var o=new(Function.bind.apply(e,r));return n&&b(o,n.prototype),o}).apply(null,arguments)}function w(e){var t="function"==typeof Map?new Map:void 0;return(w=function(e){if(null===e||-1===Function.toString.call(e).indexOf("[native code]"))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return E(e,arguments,v(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),b(n,e)})(e)}function P(e,t){return t||(t=e.slice(0)),e.raw=t,e}var k=function(){function e(){}return e.prototype.then=function(t,n){var r=new e,o=this.s;if(o){var i=1&o?t:n;if(i){try{x(r,1,i(this.v))}catch(e){x(r,2,e)}return r}return this}return this.o=function(e){try{var o=e.v;1&e.s?x(r,1,t?t(o):o):n?x(r,1,n(o)):x(r,2,o)}catch(e){x(r,2,e)}},r},e}();function x(e,t,n){if(!e.s){if(n instanceof k){if(!n.s)return void(n.o=x.bind(null,e,t));1&t&&(t=n.s),n=n.v}if(n&&n.then)return void n.then(x.bind(null,e,t),x.bind(null,e,2));e.s=t,e.v=n;var r=e.o;r&&r(e)}}function C(e){return e instanceof k&&1&e.s}var R="undefined"!=typeof Symbol?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";function F(e,t){try{var n=e()}catch(e){return t(e)}return n&&n.then?n.then(void 0,t):n}"undefined"!=typeof Symbol&&(Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator")));var S=require("btoa"),M=function(e){return S(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,(function(e,t){return String.fromCharCode(parseInt(t,16))})))},N=function(e,t,n){void 0===n&&(n="public_repo");var r=Math.random().toString(36).substring(7),o="https://github.com/login/oauth/authorize?scope="+n+"&client_id="+e+"&state="+r;return new Promise((function(e){var n;window.addEventListener("storage",(function(o){"github_auth_code"==o.key&&fetch(t+"?code="+o.newValue+"&state="+r).then((function(e){return e.json()})).then((function(t){var r=t.signedToken||null;r?localStorage.setItem("tinacms-github-token",r):console.warn("Deprecation Notice: You are using an old authentication flow, please migrate to the new one (see https://tinacms.org/blog/upgrade-notice-improved-github-security)"),n&&n.close(),e()}))})),n=function(e,t,n,r,o){return n.open(e,"_blank","toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=yes, resizable=yes, copyhistory=no, width=1000, height=700, top="+(n.top.outerHeight/2+n.top.screenY-350)+", left="+(n.top.outerWidth/2+n.top.screenX-500))}(o,0,window)}))};function _(e){return"/"===e.charAt(0)?e.substring(1):e}var B=function(){function e(e){var t=e.clientId,n=e.authCallbackRoute,r=e.baseRepoFullName,o=e.baseBranch,i=void 0===o?"master":o,a=e.authScope,u=void 0===a?"public_repo":a;this.proxy=e.proxy,this.baseRepoFullName=r,this.baseBranch=i,this.clientId=t,this.authCallbackRoute=n,this.authScope=u,this.validate()}var t,n=e.prototype;return n.authenticate=function(){return N(this.clientId,this.authCallbackRoute,this.authScope)},n.isAuthenticated=function(){return this.getUser()},n.isAuthorized=function(){var e=this;return Promise.resolve(F((function(){return Promise.resolve(e.getRepository()).then((function(e){return e.permissions.push}))}),(function(){return!1})))},n.getUser=function(){try{var e=this;return Promise.resolve(F((function(){return Promise.resolve(e.req({url:"https://api.github.com/user",method:"GET"}))}),(function(e){if(!(e.status=401))throw e})))}catch(e){return Promise.reject(e)}},n.getRepository=function(){return this.req({url:"https://api.github.com/repos/"+this.workingRepoFullName})},n.createFork=function(){try{var t=this;return Promise.resolve(t.req({url:"https://api.github.com/repos/"+t.baseRepoFullName+"/forks",method:"POST"})).then((function(n){return t.setCookie(e.WORKING_REPO_COOKIE_KEY,n.full_name),n}))}catch(e){return Promise.reject(e)}},n.createPR=function(e,t){var n=this.branchName;return this.req({url:"https://api.github.com/repos/"+this.baseRepoFullName+"/pulls",method:"POST",data:{title:e||"Update from TinaCMS",body:t||"Please pull these awesome changes in!",head:this.workingRepoFullName.split("/")[0]+":"+n,base:this.baseBranch}})},n.setWorkingRepoFullName=function(t){this.setCookie(e.WORKING_REPO_COOKIE_KEY,t)},n.setWorkingBranch=function(t){this.setCookie(e.HEAD_BRANCH_COOKIE_KEY,t)},n.fetchExistingPR=function(){try{var e=this,t=e.workingRepoFullName,n=e.branchName;return Promise.resolve(e.req({url:"https://api.github.com/repos/"+e.baseRepoFullName+"/pulls",method:"GET"})).then((function(r){for(var o=0;o<r.length;o++){var i,a,u=r[o];if(n===u.head.ref&&(null===(i=u.head.repo)||void 0===i?void 0:i.full_name)===t&&(null===(a=u.base.repo)||void 0===a?void 0:a.full_name)===e.baseRepoFullName)return u}}))}catch(e){return Promise.reject(e)}},n.getBranch=function(){try{var e=this;return Promise.resolve(F((function(){return Promise.resolve(e.req({url:"https://api.github.com/repos/"+e.workingRepoFullName+"/git/ref/heads/"+e.branchName,method:"GET"}))}),(function(e){if(!(e.status=404))throw e})))}catch(e){return Promise.reject(e)}},n.getBranchList=function(){try{return Promise.resolve(this.req({url:"https://api.github.com/repos/"+this.workingRepoFullName+"/branches",method:"GET"}))}catch(e){return Promise.reject(e)}},n.createBranch=function(e){try{var t=this;return console.log("creating branch"),Promise.resolve(t.getBranch()).then((function(n){return t.req({url:"https://api.github.com/repos/"+t.workingRepoFullName+"/git/refs",method:"POST",data:{ref:"refs/heads/"+e,sha:n.object.sha}})}))}catch(e){return Promise.reject(e)}},n.commit=function(e,t,n,r){void 0===r&&(r="Update from TinaCMS");try{var o=this.branchName;return Promise.resolve(this.req({url:"https://api.github.com/repos/"+this.workingRepoFullName+"/contents/"+_(e),method:"PUT",data:{message:r,content:M(n),sha:t,branch:o}}))}catch(e){return Promise.reject(e)}},n.getDownloadUrl=function(e){try{return Promise.resolve(this.fetchFile(e,!1)).then((function(e){return e.download_url}))}catch(e){return Promise.reject(e)}},n.fetchFile=function(e,t){void 0===t&&(t=!0);try{var n=this.branchName;return Promise.resolve(this.req({url:"https://api.github.com/repos/"+this.workingRepoFullName+"/contents/"+_(e)+"?ref="+n,method:"GET"})).then((function(e){return e.content=t?atob(e.content||""):e.content,e}))}catch(e){return Promise.reject(e)}},n.githubFileApi=function(e,t,n,r,o){void 0===n&&(n="Update from TinaCMS"),void 0===r&&(r=!1);try{var i=function(){return a.req({url:"https://api.github.com/repos/"+u+"/contents/"+_(e),method:o,data:{message:n,content:r?t:M(t),branch:c,sha:l}})},a=this,u=a.workingRepoFullName,c=a.branchName,l=null,s=F((function(){return Promise.resolve(a.fetchFile(e)).then((function(e){l=e.sha}))}),(function(){}));return Promise.resolve(s&&s.then?s.then(i):i())}catch(e){return Promise.reject(e)}},n.upload=function(e,t,n,r){void 0===n&&(n="Update from TinaCMS"),void 0===r&&(r=!1);try{return Promise.resolve(this.githubFileApi(e,t,n,r,"PUT"))}catch(e){return Promise.reject(e)}},n.delete=function(e,t){try{return void 0===t&&(t="Deleted "+e+" using TinaCMS"),Promise.resolve(this.githubFileApi(e,"",t,!1,"DELETE"))}catch(e){return Promise.reject(e)}},n.req=function(e){try{var t=this;return Promise.resolve(t.proxyRequest(e)).then((function(e){return t.getGithubResponse(e)}))}catch(e){return Promise.reject(e)}},n.getGithubResponse=function(e){try{return Promise.resolve(e.json()).then((function(t){if("2"==e.status.toString()[0])return t;throw new j(t.message||e.statusText,e.status)}))}catch(e){return Promise.reject(e)}},n.validate=function(){var e=[];if(this.proxy||e.push("Missing `proxy` URL"),this.authCallbackRoute||e.push("Missing `authCallbackRoute`"),this.baseRepoFullName||e.push("Missing `baseRepoFullName`. It may not have been set in environment variables."),this.clientId||e.push("Missing `clientId`. It may not have been set in environment variables."),e.length)throw new Error(O(e))},n.proxyRequest=function(e){var t=localStorage.getItem("tinacms-github-token")||null,n=new Headers;return t?n.append("Authorization","Bearer "+t):console.warn("Deprecation Notice: You are using an old authentication flow, please migrate to the new one (see https://tinacms.org/blog/upgrade-notice-improved-github-security)"),fetch(this.proxy,{method:"POST",headers:n,body:JSON.stringify(e)})},n.getCookie=function(e){return r.get(e)},n.setCookie=function(e,t){r.set(e,t,{sameSite:"strict"})},(t=[{key:"isFork",get:function(){return this.workingRepoFullName!==this.baseRepoFullName}},{key:"workingRepoFullName",get:function(){return this.getCookie(e.WORKING_REPO_COOKIE_KEY)||this.baseRepoFullName}},{key:"branchName",get:function(){return this.getCookie(e.HEAD_BRANCH_COOKIE_KEY)||this.baseBranch}}])&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(e.prototype,t),e}();B.WORKING_REPO_COOKIE_KEY="working_repo_full_name",B.HEAD_BRANCH_COOKIE_KEY="head_branch";var j=function(e){var t,n;function r(t,n){var r;return(r=e.call(this,t)||this).message=t,r.status=n,r}return n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n,r}(w(Error)),O=function(e){return"Failed to create the TinaCMS GithubClient\n\n"+e.map((function(e){return"\t* "+e})).join("\n")+"\n\nVisit the setup guide for more information\n\n\thttps://tinacms.org/guides/nextjs/github-open-authoring/configure-custom-app\n"},A=function(e,t,n,r){var o=this,i=this;this.cms=e,this.path=t,this.parse=n,this.serialize=r,this.sha=null,this.fetchFile=function(){try{return Promise.resolve(o.cms.api.github.fetchFile(o.path)).then((function(e){return o.sha=e.sha,o.parse?o.parse(e.content):e.content}))}catch(e){return Promise.reject(e)}},this.commit=function(e,t,n){void 0===t&&(t="Update from TinaCMS"),void 0===n&&(n=!0);try{var r=i.serialize?i.serialize(e):e;return Promise.resolve(F((function(){function e(){return Promise.resolve(i.cms.api.github.commit(i.path,i.sha,r,t)).then((function(e){return i.sha=e.content.sha,i.cms.events.dispatch({type:"github:commit",response:e}),e}))}var n=function(){if(!i.sha)return Promise.resolve(i.cms.api.github.fetchFile(i.path)).then((function(e){i.sha=e.sha}))}();return n&&n.then?n.then(e):e()}),(function(r){return function(){if(409==r.status&&n)return Promise.resolve(i.fetchFile()).then((function(){return Promise.resolve(i.commit(e,t,!1)).then((function(){}))}));throw i.cms.events.dispatch({type:"github:error",error:r}),r}()})))}catch(e){return Promise.reject(e)}}},q=function(e){var n=e.path,r=e.parse,i=e.serialize,a=o.useCMS();return t.useMemo((function(){return new A(a,n,r,i)}),[n,r,i,a])},T=function(e){var r=e.name,o=e.primary,i=e.action,c=t.useState(!1),l=c[0],s=c[1],h=t.useCallback((function(){try{return s(!0),Promise.resolve(F((function(){return Promise.resolve(i()).then((function(){s(!1)}))}),(function(e){throw s(!1),e})))}catch(e){return Promise.reject(e)}}),[i,s]);return n.createElement(a.Button,{primary:o,onClick:h,busy:l,disabled:l},l&&n.createElement(u.LoadingDots,null),!l&&r)};function G(){var e=P(["\n  color: var(--tina-color-error) !important;\n"]);return G=function(){return e},e}function I(e){var t=e.onAuthSuccess,r=e.close,o=i.useCMS();return n.createElement(D,{title:"GitHub Authorization",message:"To save edits, Tina requires GitHub authorization. On save, changes will get commited to GitHub using your account.",close:r,actions:[{name:"Cancel",action:r},{name:"Continue to GitHub",action:function(){try{return Promise.resolve(o.api.github.authenticate()).then((function(){t()}))}catch(e){return Promise.reject(e)}},primary:!0}]})}function z(e){var r=e.onForkCreated,o=e.close,a=i.useCMS(),u=t.useState(),c=u[1];return n.createElement(D,{title:"GitHub Authorization",message:"A fork of this website is required to save changes.",close:o,actions:[{name:"Cancel",action:o},{name:"Create Fork",action:function(){try{return Promise.resolve(F((function(){return Promise.resolve(a.api.github.createFork()).then((function(){r()}))}),(function(e){throw c("Forking repository failed. Are you sure the repository is public?"),e})))}catch(e){return Promise.reject(e)}},primary:!0}],error:u[0]})}function D(e){return n.createElement(a.StyleReset,null,n.createElement(i.Modal,null,n.createElement(i.ModalPopup,null,n.createElement(i.ModalHeader,{close:e.close},e.title),n.createElement(i.ModalBody,{padded:!0},n.createElement("p",null,e.message),e.error&&n.createElement(H,null,e.error)),n.createElement(i.ModalActions,null,e.actions.map((function(e){return n.createElement(T,Object.assign({},e))}))))))}var H=l.p(G()),K=function(e){var t=e.message,r=e.actions;return open?n.createElement(a.StyleReset,null,n.createElement(i.Modal,null,n.createElement(i.ModalPopup,null,n.createElement(i.ModalHeader,null,e.title),n.createElement(i.ModalBody,{padded:!0},n.createElement("p",null,t)),n.createElement(i.ModalActions,null,r.map((function(e){return n.createElement(a.Button,{primary:e.primary,onClick:e.action},e.name)})))))):null},U=function(e){var r=t.useState(null),o=r[0],a=r[1],u=i.useCMS().api.github,c=i.useCMS();return t.useEffect((function(){!function(){try{var t=function(){if(e.error)return Promise.resolve(function(e,t,n,r,o){try{var i=function(t){return a?t:{title:"Error  "+e.status,message:e.message,actions:[c,u]}},a=!1,u={name:"Continue",primary:!0,action:r},c={name:"Cancel",primary:!1,action:o},l={name:"Switch to "+n.baseBranch,primary:!0,action:function(){n.setWorkingBranch(n.baseBranch),t.events.dispatch({type:"github:branch:checkout",branchName:n.baseBranch})}},s=function(e,t){var n,r=-1;e:{for(var o=0;o<t.length;o++){var i=t[o][0];if(i){var a=i();if(a&&a.then)break e;if(a===e){r=o;break}}else r=o}if(-1!==r){do{for(var u=t[r][1];!u;)r++,u=t[r][1];var c=u();if(c&&c.then){n=!0;break e}var l=t[r][2];r++}while(l&&!l());return c}}var s=new k,h=x.bind(null,s,2);return(n?c.then(m):a.then((function n(a){for(;;){if(a===e){r=o;break}if(++o===t.length){if(-1!==r)break;return void x(s,1,c)}if(i=t[o][0]){if((a=i())&&a.then)return void a.then(n).then(void 0,h)}else r=o}do{for(var u=t[r][1];!u;)r++,u=t[r][1];var c=u();if(c&&c.then)return void c.then(m).then(void 0,h);var l=t[r][2];r++}while(l&&!l());x(s,1,c)}))).then(void 0,h),s;function m(e){for(;;){var n=t[r][2];if(!n||n())break;r++;for(var o=t[r][1];!o;)r++,o=t[r][1];if((e=o())&&e.then)return void e.then(m).then(void 0,h)}x(s,1,e)}}(e.status,[[function(){return 401},function(){return a=!0,{title:"401 Unauthenticated",message:"Authentication is invalid",actions:[c,u]}}],[function(){return 404},function(){return Promise.resolve(n.isAuthorized()).then((function(e){return e?Promise.resolve(n.getBranch()).then((function(e){return e?(a=!0,{title:"Missing Branch ",message:"The branch that you were editing has been deleted. Press.",actions:[c,l]}):(a=!0,{title:"Content Not Found.",message:"The file you are trying to access is missing. Maybe it lives on a different branch?",actions:[c,l]})})):"public_repo"===n.authScope?(a=!0,{title:"Create a Fork of "+n.baseRepoFullName,message:"You do not have permission to make changes to "+n.baseRepoFullName+".Press the button below to fork this site and begin editing. ",actions:[c,{name:"Create a Fork",primary:!0,action:r}]}):(a=!0,{title:"Unauthorized",message:"You do not have permission to make changes to "+n.baseRepoFullName+".",actions:[c]})}))}],[function(){return 500},function(){return a=!0,{title:"Error 500",message:e.message,actions:[u]}}]]);return Promise.resolve(s&&s.then?s.then(i):i(s))}catch(e){return Promise.reject(e)}}(e.error,c,u,c.enable,c.disable)).then((function(e){a(e)}));a(null)}();t&&t.then&&t.then((function(){}))}catch(e){Promise.reject(e)}}()}),[e.error,c.enable]),o?n.createElement(K,Object.assign({},o)):null};function Y(e,n,r){var o=i.useCMS();t.useEffect((function(){return o.events.subscribe(e,n)}),r)}function L(){var e=P(["\n  padding: 1.25rem 1.25rem 0 1.25rem;\n"]);return L=function(){return e},e}function W(){var e=P(["\n  margin-bottom: 1rem;\n\n  b {\n    font-weight: bold;\n  }\n"]);return W=function(){return e},e}function V(){var e=P(["\n  height: auto;\n  padding-top: 0.8125rem;\n  padding-bottom: 0.8125rem;\n  text-decoration: none;\n  line-height: 1;\n"]);return V=function(){return e},e}var J=function(){var e=t.useState(""),r=e[0],o=e[1],a=t.useState(void 0),u=a[0],c=a[1],l=i.useCMS().api.github,s=n.createRef(),m=n.createRef(),f=function(){try{return Promise.resolve(l.fetchExistingPR().then((function(e){c(e||{id:null})})).catch((function(){o("Could not fetch Pull Requests")}))).then((function(){}))}catch(e){return Promise.reject(e)}};if(t.useEffect((function(){f()}),[]),r)return n.createElement(Z,null,n.createElement(Q,null,n.createElement("p",null,r)));if(!u)return n.createElement(Z,null,n.createElement(Q,null,n.createElement("p",null,"Loading...")));var p=l.branchName,d=l.baseBranch;return l.isFork&&(p=l.workingRepoFullName.split("/")[0]+":"+p,d=l.baseRepoFullName.split("/")[0]+":"+d),p===d?n.createElement(Z,null,n.createElement(Q,null,n.createElement("p",null,"You are currently on the base branch: ",n.createElement("b",null,d),"."),n.createElement("p",null,"To create a Pull Request you must first switch to a new branch."))):n.createElement(n.Fragment,null,n.createElement(Z,null,!u.id&&n.createElement(n.Fragment,null,n.createElement(Q,null,"Create a pull request from ",n.createElement("b",null,p)," into"," ",n.createElement("b",null,d),"."," ",n.createElement("a",{target:"_blank",href:"https://github.com/"+l.baseRepoFullName+"/compare/"+l.baseBranch+"..."+l.workingRepoFullName.split("/")[0]+":"+l.branchName},"View changes on GitHub"),"."),n.createElement(i.FieldMeta,{label:"PR Title",name:"title"},n.createElement(h.Input,{type:"text",ref:s})),n.createElement(i.FieldMeta,{label:"PR Description",name:"description"},n.createElement(h.TextArea,{ref:m}))),u.id&&n.createElement(Q,null,"You've created a pull request from ",n.createElement("b",null,p)," into"," ",n.createElement("b",null,d),".")),n.createElement(i.ModalActions,null,!u.id&&n.createElement(T,{primary:!0,name:"Create Pull Request",action:function(){return l.createPR(s.current.value,m.current.value).then((function(){f()})).catch((function(){o("Pull Request failed, are you sure you have any changes?")}))}}),u&&u.html_url&&n.createElement(n.Fragment,null,n.createElement(X,{as:"a",href:"https://github.com/"+l.baseRepoFullName+"/compare/"+l.baseBranch+"..."+l.workingRepoFullName.split("/")[0]+":"+l.branchName,target:"_blank"},"View Diff"),n.createElement(X,{as:"a",primary:!0,href:u.html_url,target:"_blank"},"View Pull Request"))))},X=l(a.Button)(V()),Q=l.p(W()),Z=l(i.ModalBody)(L());function $(){var e=P(["\n  display: flex;\n  align-items: center;\n  white-space: nowrap;\n  padding: 0 10px;\n\n  &:focus {\n    outline: none;\n  }\n\n  svg {\n    fill: currentColor;\n    opacity: 0.7;\n    width: 2.5em;\n    height: 2.5em;\n  }\n\n  &:disabled {\n    opacity: 0.6;\n    filter: grayscale(25%);\n  }\n\n  @media (min-width: 1030px) {\n    padding: 0 20px;\n\n    svg {\n      margin-right: 0.25rem;\n    }\n  }\n"]);return $=function(){return e},e}var ee=l(a.Button)($());function te(){var e=P(["\n  display: none;\n  @media (min-width: 1030px) {\n    display: inline;\n  }\n"]);return te=function(){return e},e}var ne=l.span(te()),re={__type:"toolbar:widget",name:"create-pr",weight:5,component:function(){var e=t.useState(!1),r=e[0],o=e[1];return n.createElement(n.Fragment,null,n.createElement(ee,{onClick:function(){return o((function(e){return!e}))}},n.createElement(s.PullRequestIcon,null),n.createElement(ne,null," Pull Request")),r&&n.createElement(i.Modal,null,n.createElement(i.ModalPopup,null,n.createElement(i.ModalHeader,{close:function(){return o(!1)}},"Pull Request"),n.createElement(i.ModalBody,null,n.createElement(J,null)))))}};function oe(){var e=P(["\n  display: block;\n  max-width: 250px;\n  overflow: hidden;\n  white-space: nowrap;\n  text-overflow: ellipsis;\n  font-size: var(--tina-font-size-3);\n  line-height: 1.35;\n  color: var(--tina-color-primary-dark);\n"]);return oe=function(){return e},e}var ie=l.a(oe()),ae={__type:"toolbar:widget",name:"repo-info",weight:1,component:function(){var e=i.useCMS().api.github;return n.createElement(i.FieldMeta,{name:e.isFork?"Fork":"Repository"},n.createElement(ie,{target:"_blank",href:"https://github.com/"+e.workingRepoFullName},e.workingRepoFullName))}};function ue(){var e=P(["\n  color: var(--tina-color-grey-6);\n  display: block;\n  text-align: left;\n  line-height: 20px;\n  font-size: var(--tina-font-size-3);\n  text-overflow: ellipsis;\n  max-width: 250px;\n  white-space: nowrap;\n  overflow: hidden;\n"]);return ue=function(){return e},e}function ce(){var e=P(["\n  color: var(--tina-color-grey-8);\n  display: block;\n  letter-spacing: 0.01em;\n  line-height: 1;\n  font-size: var(--tina-font-size-1);\n  font-weight: 600;\n  text-align: left;\n  transition: all 150ms ease-out;\n"]);return ce=function(){return e},e}function le(){var e=P(["\n      background-color: var(--tina-color-grey-1);\n      box-shadow: inset 0px 2px 3px rgba(0, 0, 0, 0.06);\n\n      "," {\n        color: var(--tina-color-primary);\n      }\n\n      svg {\n        transform: translate3d(0, -50%, 0) rotate(180deg);\n        fill: var(--tina-color-grey-4);\n      }\n    "]);return le=function(){return e},e}function se(){var e=P(["\n  border-radius: var(--tina-radius-small);\n  border: 1px solid var(--tina-color-grey-2);\n  background-color: white;\n  padding: 5px 42px 5px var(--tina-padding-small);\n  position: relative;\n  outline: none;\n  cursor: pointer;\n  min-width: 140px;\n  transition: all 150ms ease-out;\n\n  :hover {\n    background-color: var(--tina-color-grey-1);\n  }\n\n  svg {\n    fill: var(--tina-color-primary);\n    position: absolute;\n    top: 50%;\n    right: 8px;\n    transform-origin: 50% 50%;\n    transform: translate3d(0, -50%, 0);\n    transition: all 150ms ease-out;\n    width: 24px;\n    height: auto;\n  }\n\n  ",";\n"]);return se=function(){return e},e}function he(){var e=P(["\n      opacity: 1;\n      pointer-events: auto;\n      transform: translate3d(-50%, 100%, 0) scale3d(1, 1, 1);\n    "]);return he=function(){return e},e}function me(){var e=P(["\n  position: absolute;\n  bottom: -4px;\n  left: 50%;\n  transform: translate3d(-50%, calc(100% - 16px), 0) scale3d(0.5, 0.5, 1);\n  border-radius: var(--tina-radius-small);\n  border: 1px solid var(--tina-color-grey-2);\n  box-shadow: var(--tina-shadow-big);\n  background-color: white;\n  transform-origin: 50% 0;\n  pointer-events: none;\n  transition: all 150ms ease-out;\n  opacity: 0;\n  width: 350px;\n\n  &:before {\n    content: '';\n    display: block;\n    position: absolute;\n    top: 0;\n    left: 50%;\n    transform: translate3d(-50%, -100%, 0);\n    width: 0;\n    height: 0;\n    border-left: 10px solid transparent;\n    border-right: 10px solid transparent;\n    border-bottom: 10px solid var(--tina-color-grey-2);\n  }\n\n  &:after {\n    content: '';\n    display: block;\n    position: absolute;\n    top: 1px;\n    left: 50%;\n    transform: translate3d(-50%, -100%, 0);\n    width: 0;\n    height: 0;\n    border-left: 10px solid transparent;\n    border-right: 10px solid transparent;\n    border-bottom: 10px solid white;\n  }\n\n  ",";\n"]);return me=function(){return e},e}function fe(){var e=P(["\n  position: relative;\n"]);return fe=function(){return e},e}function pe(){var e=P(["\n  min-width: 200px;\n  max-height: 170px;\n  overflow-y: scroll;\n  display: flex;\n  flex-direction: column;\n  justify-content: flex-start;\n  align-items: stretch;\n"]);return pe=function(){return e},e}function de(){var e=P(["\n      font-weight: bold;\n      color: var(--tina-color-primary);\n      background-color: var(--tina-color-grey-1);\n      pointer-events: none;\n    "]);return de=function(){return e},e}function ge(){var e=P(["\n  display: lock;\n  border: none;\n  outline: none;\n  padding: 4px var(--tina-padding-small);\n  background: transparent;\n  color: var(--tina-color-grey-6);\n  text-align: left;\n  font-size: var(--tina-font-size-2);\n  line-height: 1.2;\n  white-space: nowrap;\n  width: 100%;\n  cursor: pointer;\n  transition: all 150ms ease-out;\n  text-overflow: ellipsis;\n  max-width: 100%;\n  overflow: hidden;\n  flex: 0 0 auto;\n\n  svg {\n    width: 20px;\n    height: auto;\n    margin: -4px -4px -4px -4px;\n    fill: currentColor;\n    opacity: 0.7;\n  }\n\n  :first-child {\n    padding-top: 8px;\n  }\n\n  :last-child {\n    padding-bottom: 8px;\n  }\n\n  :hover {\n    color: var(--tina-color-primary);\n    background-color: var(--tina-color-grey-1);\n  }\n\n  ",";\n"]);return ge=function(){return e},e}function ve(){var e=P(["\n  display: flex;\n  border: none;\n  outline: none;\n  padding: var(--tina-padding-small);\n  background: transparent;\n  width: 100%;\n  justify-content: center;\n  align-items: center;\n  flex: 0 0 auto;\n"]);return ve=function(){return e},e}function be(){var e=P(["\n  display: block;\n  border: none;\n  outline: none;\n  padding: var(--tina-padding-small);\n  background: transparent;\n  color: var(--tina-color-grey-4);\n  text-align: left;\n  font-size: var(--tina-font-size-2);\n  line-height: 1.4;\n  width: 100%;\n  transition: all 150ms ease-out;\n  flex: 0 0 auto;\n"]);return be=function(){return e},e}function ye(){var e=P(["\n  padding: var(--tina-padding-small);\n  border-bottom: 1px solid var(--tina-color-grey-2);\n"]);return ye=function(){return e},e}function Ee(){var e=P(["\n  background-color: var(--tina-color-grey-1);\n  border-top: 1px solid var(--tina-color-grey-2);\n  padding: var(--tina-padding-small);\n"]);return Ee=function(){return e},e}function we(){var e=P(["\n  font-weight: bold;\n  color: var(--tina-color-primary);\n"]);return we=function(){return e},e}function Pe(){var e=P(["\n  display: flex;\n  align-items: center;\n  height: 36px;\n\n  svg {\n    width: 24px;\n    margin-right: 4px;\n    opacity: 0.7;\n  }\n"]);return Pe=function(){return e},e}function ke(){var e=P(["\n  height: 36px;\n  flex: 0 1 auto;\n\n  ::placeholder {\n    color: var(--tina-color-grey-4);\n  }\n"]);return ke=function(){return e},e}function xe(){var e=P(["\n  padding: 0 var(--tina-padding-big) var(--tina-padding-big)\n    var(--tina-padding-big);\n"]);return xe=function(){return e},e}var Ce=function(e){var n=e.current,r=e.name,o=e.onBranchChange,u=e.close,c=i.useCMS(),l=t.useMemo((function(){return new i.Form({label:"create-branch",id:"create-branch-id",initialValues:{name:r},fields:[{label:"Branch Name",name:"name",component:"text"}],onSubmit:function(e){var t=e.name;try{var n=F((function(){return Promise.resolve(c.api.github.createBranch(t)).then((function(){c.events.dispatch({type:"github:branch:create",branchName:t}),c.api.github.setWorkingBranch(t),c.events.dispatch({type:"github:branch:checkout",branchName:t}),o&&o(t)}))}),(function(e){c.events.dispatch({type:"github:error",error:e})}));return Promise.resolve(n&&n.then?n.then((function(){})):void 0)}catch(e){return Promise.reject(e)}}})}),[c]);return t.createElement(i.Modal,null,t.createElement(i.FormBuilder,{form:l},(function(e){var o=e.handleSubmit;return t.createElement(i.ModalPopup,null,t.createElement(i.ModalHeader,{close:u},"Create Branch"),t.createElement(i.ModalBody,{onKeyPress:function(e){return 13===e.charCode?o():null}},t.createElement(i.FieldsBuilder,{form:l,fields:l.fields}),t.createElement(Fe,null,t.createElement("p",null,"Create branch ",t.createElement(Ne,null,r)," from '",n,"'"))),t.createElement(i.ModalActions,null,t.createElement(a.Button,{onClick:u},"Cancel"),t.createElement(a.Button,{onClick:o,primary:!0},"Create")))})))},Re=function(e){var n=e.name,r=e.onBranchChange,o=e.close;return t.createElement(i.Modal,null,t.createElement(i.ModalPopup,null,t.createElement(i.ModalHeader,{close:o},"Switch Branch"),t.createElement(i.ModalBody,{padded:!0,onKeyPress:function(e){return 13===e.charCode?r():null}},t.createElement("p",null,"Are you sure you want to switch to branch"," ",t.createElement(Ne,null,n),"?")),t.createElement(i.ModalActions,null,t.createElement(a.Button,{onClick:o},"Cancel"),t.createElement(a.Button,{onClick:r,primary:!0},"Switch Branch"))))},Fe=l.div(xe()),Se=l(i.Input)(ke()),Me=l(a.Button)(Pe()),Ne=l.span(we()),_e=l.div(Ee()),Be=l.div(ye()),je=l.div(be()),Oe=l.div(ve()),Ae=l.button(ge(),(function(e){return e.active&&c.css(de())})),qe=l.div(pe()),Te=l.div(fe()),Ge=l.div(me(),(function(e){return e.open&&c.css(he())})),Ie=l.button(se(),(function(e){return e.open&&c.css(le(),ze)})),ze=l.span(ce()),De=l.span(ue()),He={__type:"toolbar:widget",name:"branch-switcher",weight:1,component:function(e){var n=e.onBranchChange,r=i.useCMS(),o=r.api.github,a=t.useState(!1),c=a[0],l=a[1],h=t.useState(),f=h[0],p=h[1],d=t.useState(),g=d[0],v=d[1],b=t.useState(""),y=b[0],E=b[1],w=t.useRef(),P=t.useState("pending"),k=P[0],x=P[1],C=t.useState([]),R=C[0],F=C[1],S=t.useCallback((function(){o.getBranchList().then((function(e){F(e),x("loaded")})).catch((function(){x("error")}))}),[o,F,x]);t.useEffect((function(){S(),r.events.subscribe("github:branch:create",S)}),[]);var M=function(){l(!1),E(""),w.current&&(w.current.scrollTop=0)},N=R.filter((function(e){return e.name.includes(y)}));return t.createElement(t.Fragment,null,t.createElement(Te,null,t.createElement(Ie,{onClick:function(){return l(!c)},open:c},t.createElement(ze,null,"Branch"),t.createElement(De,null,o.branchName),t.createElement(s.ChevronDownIcon,null)),t.createElement(Ge,{open:c},t.createElement(m.Dismissible,{click:!0,escape:!0,disabled:!c,onDismiss:M},t.createElement(Be,null,t.createElement(Se,{placeholder:"Filter",onChange:function(e){return E(e.target.value)},value:y})),t.createElement(qe,{ref:w},"pending"===k&&t.createElement(Oe,null,t.createElement(u.LoadingDots,{color:"var(--tina-color-primary)"})),"loaded"===k&&t.createElement(t.Fragment,null,N.map((function(e){return t.createElement(Ae,{key:e.name,active:e.name===o.branchName,onClick:function(){p(e),M()}},e.protected&&t.createElement(s.LockIcon,null)," ",e.name)})),0===N.length&&t.createElement(je,null,"No branches to display.")),"error"===k&&t.createElement(je,null,"We had trouble loading branches. Please refresh to try again.")),t.createElement(_e,null,t.createElement(Me,{onClick:function(){v({name:y}),M()}},t.createElement(s.AddIcon,null)," New Branch"))))),g&&t.createElement(Ce,{current:o.branchName,name:g.name,onBranchChange:function(e){n&&n(e),v(null)},close:function(){v(null)}}),f&&t.createElement(Re,{name:f.name,onBranchChange:function(){r.alerts.info("Switched to branch "+f.name),o.setWorkingBranch(f.name),M(),n&&n(f.name),p(null),v(null),r.events.dispatch({type:"github:branch:checkout",branchName:f.name})},close:function(){p(null)}}))}},Ke=function(e){return e.name},Ue=function(e,t){var n=i.useCMS(),r=q({path:e.fileRelativePath,serialize:t.serialize}),o=i.useForm({id:e.fileRelativePath,label:t.label||e.fileRelativePath,initialValues:e.data,fields:t.fields||[],actions:t.actions||[],onSubmit:function(e){var t=n.api.github;return r.commit(e).then((function(){n.alerts.success("Saved Successfully: Changes committed to "+t.workingRepoFullName)})).catch((function(e){var t;return(t={})[p.FORM_ERROR]=e,t}))}});return[o[0]||e.data,o[1]]},Ye=function(e){return JSON.stringify(e,null,2)},Le=function(){function e(e){this.githubClient=e,this.accept="*"}var t=e.prototype;return t.persist=function(e){try{var t=this,n=[],r=function(e,t,n){if("function"==typeof e[R]){var r,o,i,a=e[R]();if(function e(n){try{for(;!(r=a.next()).done;)if((n=t(r.value))&&n.then){if(!C(n))return void n.then(e,i||(i=x.bind(null,o=new k,2)));n=n.v}o?x(o,1,n):o=n}catch(e){x(o||(o=new k),2,e)}}(),a.return){var u=function(e){try{r.done||a.return()}catch(e){}return e};if(o&&o.then)return o.then(u,(function(e){throw u(e)}));u()}return o}if(!("length"in e))throw new TypeError("Object is not iterable");for(var c=[],l=0;l<e.length;l++)c.push(e[l]);return function(e,t,n){var r,o,i=-1;return function n(a){try{for(;++i<e.length;)if((a=t(i))&&a.then){if(!C(a))return void a.then(n,o||(o=x.bind(null,r=new k,2)));a=a.v}r?x(r,1,a):r=a}catch(e){x(r||(r=new k),2,e)}}(),r}(c,(function(e){return t(c[e])}))}(e,(function(e){var r=e.file,o=e.directory,i="/"===o.charAt(0)?(o+r.name).slice(1):o+r.name,a=F((function(){return Promise.resolve(function(e){return new Promise((function(t){var n=new FileReader;n.readAsDataURL(e),n.onload=function(){if(!n.result)throw new Error("base64File: No result");t(n.result)}}))}(r)).then((function(e){var a=e.toString().split(",")[1];return Promise.resolve(t.githubClient.upload(i,a,"Upload",!0)).then((function(){n.push({directory:o,filename:r.name})}))}))}),(function(e){console.warn("Failed to upload content to Github: "+e)}));if(a&&a.then)return a.then((function(){}))}));return Promise.resolve(r&&r.then?r.then((function(){return n})):n)}catch(e){return Promise.reject(e)}},t.previewSrc=function(e){try{try{return Promise.resolve(this.githubClient.getDownloadUrl(e))}catch(t){return Promise.resolve(e)}}catch(e){return Promise.reject(e)}},e}();exports.CreateForkModal=z,exports.ErrorLabel=H,exports.GITHUB_AUTH_CODE_KEY="github_auth_code",exports.GithubAuthenticationModal=I,exports.GithubClient=B,exports.GithubFile=A,exports.GithubMediaStore=Le,exports.ModalBuilder=D,exports.RepoToolbarWidget=ae,exports.TinacmsGithubProvider=function(e){var r=e.children,o=e.onLogin,a=e.onLogout,u=e.error,c=t.useState(u),l=c[0],s=c[1],h=i.useCMS(),m=h.api.github,f=t.useState(null),p=f[0],d=f[1],g=function(){try{return d(null),Promise.resolve(m.isAuthorized()).then((function(e){e||h.disable()}))}catch(e){return Promise.reject(e)}},v=function(){try{return Promise.resolve(m.isAuthorized()).then((function(e){e?(m.setWorkingRepoFullName(m.baseRepoFullName),m.setWorkingBranch(m.branchName),o(),d(null)):d("createFork")}))}catch(e){return Promise.reject(e)}};return Y("cms:enable",(function(){try{return Promise.resolve(m.isAuthenticated()).then((function(e){e?v():d("authenticate")}))}catch(e){return Promise.reject(e)}}),[]),Y("cms:disable",a,[]),Y("github:branch:checkout",o,[]),Y("github:error",(function(e){return s(e.error)}),[]),n.createElement(n.Fragment,null,l&&n.createElement(U,{error:l}),!l&&"authenticate"===p&&n.createElement(I,{close:g,onAuthSuccess:v}),!l&&"createFork"===p&&n.createElement(z,{close:g,onForkCreated:o}),!u&&r)},exports.authenticate=N,exports.createGithubDeleteAction=function(e){var n=void 0===e?{getTitle:Ke,getFilePath:Ke}:e,r=n.getTitle,i=void 0===r?Ke:r,c=n.getFilePath,l=void 0===c?Ke:c;return function(e){var n=e.form,r=o.useCMS(),c=t.useState(!1),s=c[0],h=c[1],m=function(){return h(!1)},p=i(n),d=l(n);return t.createElement(t.Fragment,null,t.createElement(u.ActionButton,{onClick:function(){return h(!0)}},"Delete "+p),s&&t.createElement(f.Modal,null,t.createElement(f.ModalPopup,null,t.createElement(f.ModalHeader,{close:m},"Delete "+p," "),t.createElement(f.ModalBody,null,"Are you sure you want to delete "+p),t.createElement(f.ModalActions,null,t.createElement(a.Button,{onClick:function(){try{var e=function(e,t){try{var n=F((function(){return m(),Promise.resolve(r.api.github.delete(d)).then((function(){}))}),(function(e){m(),console.error(e)}))}catch(e){return t(!0,e)}return n&&n.then?n.then(t.bind(null,!1),t.bind(null,!0)):t(!1,n)}(0,(function(e,t){if(window.history.back(),e)throw t;return t}));return Promise.resolve(e&&e.then?e.then((function(){})):void 0)}catch(e){return Promise.reject(e)}}},"Yes"),t.createElement(a.Button,{onClick:m},"No")))))}},exports.useGithubAuthRedirect=function(){t.useEffect((function(){var e=new URLSearchParams(window.location.search).get("code");localStorage.github_auth_code=e}),[])},exports.useGithubFile=q,exports.useGithubFileForm=Ue,exports.useGithubJsonForm=function(e,t){return Ue(e,g({},t,{serialize:Ye}))},exports.useGithubMarkdownForm=function(e,t){return Ue(e,g({},t,{serialize:d.toMarkdownString}))},exports.useGithubToolbarPlugins=function(){i.usePlugins([ae,re,He])};
//# sourceMappingURL=react-tinacms-github.cjs.production.min.js.map
